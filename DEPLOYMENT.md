# Deployment Guide for Render

This guide will help you deploy your PrtclTech application to Render.

## Prerequisites

1. A GitHub repository with your code
2. A Render account (free tier available)
3. An Anthropic API key (for AI features)

## Quick Deployment Steps

### 1. Connect Your Repository

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click "New +" → "Web Service"
3. Connect your GitHub repository
4. Select your repository

### 2. Configure the Web Service

**Basic Settings:**
- **Name**: `prtcltech-app` (or your preferred name)
- **Environment**: `Docker`
- **Region**: Choose closest to your users
- **Branch**: `main`
- **Root Directory**: Leave empty (root of repo)
- **Dockerfile Path**: `./Dockerfile`
- **Docker Command**: `/app/start.sh`

**Plan:**
- **Free**: For testing and development
- **Starter**: For production use ($7/month)

### 3. Environment Variables

Add these environment variables in Render:

#### Required Variables:
```
DJANGO_SETTINGS_MODULE=prtcltech.production
DEBUG=False
SECRET_KEY=<auto-generated>
ANTHROPIC_API_KEY=your-anthropic-api-key
```

#### Database Variables (Auto-provided by Render):
```
POSTGRES_DB=prtcltech
POSTGRES_USER=prtcltech
POSTGRES_PASSWORD=<auto-generated>
POSTGRES_HOST=<auto-generated>
POSTGRES_PORT=5432
```

#### Redis Variables (Auto-provided by Render):
```
REDIS_URL=<auto-generated>
```

#### Optional Variables:
```
CUSTOM_DOMAIN=yourdomain.com
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
DEFAULT_FROM_EMAIL=noreply@yourdomain.com
```

### 4. Create Databases

#### PostgreSQL Database:
1. Go to "New +" → "PostgreSQL"
2. Name: `prtcltech-db`
3. Database: `prtcltech`
4. User: `prtcltech`
5. Plan: `Starter` ($7/month) or `Free` for testing

#### Redis Database:
1. Go to "New +" → "Redis"
2. Name: `prtcltech-redis`
3. Plan: `Starter` ($7/month) or `Free` for testing

### 5. Link Services

1. In your web service settings, go to "Environment"
2. Add the database URLs as environment variables:
   - `DATABASE_URL` from PostgreSQL service
   - `REDIS_URL` from Redis service

## Alternative: Using render.yaml (Blue-Green Deployment)

If you want to use the `render.yaml` file for automatic deployment:

1. Push your code with the `render.yaml` file
2. Go to Render Dashboard
3. Click "New +" → "Blueprint"
4. Connect your repository
5. Render will automatically create all services

## Post-Deployment Setup

### 1. Create Superuser

After deployment, create a superuser:

```bash
# Connect to your Render service via SSH or use the shell
python manage.py createsuperuser
```

### 2. Verify Deployment

1. Visit your app URL: `https://your-app-name.onrender.com`
2. Check the admin panel: `https://your-app-name.onrender.com/admin`
3. Test the API: `https://your-app-name.onrender.com/api/`

### 3. Set Up Custom Domain (Optional)

1. In your web service settings, go to "Settings"
2. Click "Add Custom Domain"
3. Follow the DNS configuration instructions

## Troubleshooting

### Common Issues:

1. **Build Fails**: Check the build logs for missing dependencies
2. **Database Connection**: Verify database environment variables
3. **Static Files**: Ensure `collectstatic` runs during deployment
4. **CORS Errors**: Update `CORS_ALLOWED_ORIGINS` in production settings

### Specific Errors:

#### npm ci Error:
If you see an error like "npm ci command can only install with an existing package-lock.json":
- The Dockerfile has been updated to use `npm install` instead of `npm ci`
- This is fixed in the latest version

#### Gunicorn Not Found:
If you see "gunicorn: command not found":
- Gunicorn has been added to requirements.txt
- Make sure you're using the latest code

### Debugging:

1. Check Render logs in the dashboard
2. Use Render's shell feature to debug
3. Verify environment variables are set correctly

## Performance Optimization

### For Production:

1. **Upgrade Plans**: Use paid plans for better performance
2. **CDN**: Consider using a CDN for static files
3. **Caching**: Redis is already configured for caching
4. **Database**: Use connection pooling for high traffic

### Monitoring:

1. Set up health checks
2. Monitor logs regularly
3. Set up alerts for downtime

## Cost Estimation

### Free Tier:
- Web Service: Free (sleeps after 15 minutes of inactivity)
- PostgreSQL: Free (90 days)
- Redis: Free (90 days)

### Paid Tier (Recommended for Production):
- Web Service: $7/month
- PostgreSQL: $7/month
- Redis: $7/month
- **Total**: ~$21/month

## Security Considerations

1. **Environment Variables**: Never commit secrets to Git
2. **HTTPS**: Automatically provided by Render
3. **Database**: Use strong passwords
4. **API Keys**: Rotate regularly
5. **Updates**: Keep dependencies updated

## Support

- [Render Documentation](https://render.com/docs)
- [Render Community](https://community.render.com/)
- [Django Deployment Guide](https://docs.djangoproject.com/en/stable/howto/deployment/)

## Next Steps

After successful deployment:

1. Set up monitoring and alerts
2. Configure backups for your database
3. Set up CI/CD for automatic deployments
4. Consider using AWS S3 for file storage
5. Implement user authentication and authorization 